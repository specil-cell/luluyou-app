{"uid":"69a051a6932ed072","name":"test_handle_modal_01","fullName":"tests.test_login.TestShouYe_1#test_handle_modal_01","historyId":"1bc757fa330ac8fdac7ad7d5dcf62937","time":{"start":1692777132286,"stop":1692777135759,"duration":3473},"status":"broken","statusMessage":"minium.framework.exception.PageDestroyed: page destroyed","statusTrace":"args = ('/page/view/biz-index-head/view/view',), kwargs = {}\nattr = <bound method Page.get_elements of Page(id=86, path=/pages/trip/spot-detail, query={'spotId': 'a705468ad4674dea805f051c5e27c9e6', 'activityId': '6d4c3aed7bc9402d871788bb4d0adda6', 'appointId': '9273321a2703426dbab0c04e4ca0ca64'})>\n\n    @functools.wraps(func)\n    def wrapper(*args, **kwargs):\n        try:\n>           return func(*args, **kwargs)\n\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\miniprogram\\base_driver\\app.py:214: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nargs = (Page(id=86, path=/pages/trip/spot-detail, query={'spotId': 'a705468ad4674dea805f051c5e27c9e6', 'activityId': '6d4c3aed7bc9402d871788bb4d0adda6', 'appointId': '9273321a2703426dbab0c04e4ca0ca64'}), '/page/view/biz-index-head/view/view')\nkwargs = {}, start = datetime.datetime(2023, 8, 23, 15, 52, 15, 432193)\nself = Page(id=86, path=/pages/trip/spot-detail, query={'spotId': 'a705468ad4674dea805f051c5e27c9e6', 'activityId': '6d4c3aed7bc9402d871788bb4d0adda6', 'appointId': '9273321a2703426dbab0c04e4ca0ca64'})\nfunc_name = 'Page.get_elements'\n\n    @wraps(func)\n    def wrapper(*args, **kwargs):\n        global usage, app_id\n    \n        start = datetime.datetime.now()\n        self = args[0]\n        func_name = f\"{self.__class__.__name__}.{func.__name__}\"\n        try:\n>           result = func(*args, **kwargs)\n\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\miniprogram\\base_driver\\minium_log.py:172: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = Page(id=86, path=/pages/trip/spot-detail, query={'spotId': 'a705468ad4674dea805f051c5e27c9e6', 'activityId': '6d4c3aed7bc9402d871788bb4d0adda6', 'appointId': '9273321a2703426dbab0c04e4ca0ca64'})\nselector = None, max_timeout = 0, inner_text = None, text_contains = None\nvalue = None, index = -1, xpath = '/page/view/biz-index-head/view/view'\n\n    def get_elements(\n        self,\n        selector,\n        max_timeout=0,\n        inner_text=None,\n        text_contains=None,\n        value=None,\n        index=-1,\n        xpath=None,\n    ) -> typing.List[ElementType]:\n        \"\"\"\n        find elements in current page, by css selector\n        :param selector: 选择器\n        :param inner_text: inner_text\n        :param value: value\n        :param text_contains: 包含的文字\n        :param max_timeout: 超时时间\n        :param index: index == -1: get所有, index >=0: get index+1个\n        :param xpath: 使用xpath\n        :return:element 对象 list\n        \"\"\"\n        if selector and selector.startswith(\"/\"):\n            # 以/或//开头的认为是xpath\n            xpath = selector\n            selector = None\n        if inner_text is None and value is None and text_contains is None:\n            need_filter = False\n        else:\n            need_filter = True\n        if not need_filter and selector:\n            # 不需要过滤内容，直接返回\n            return self._get_elements_by_css(selector, max_timeout, index=index)\n        elif xpath:\n            # xpath支持text() contains()等条件，不需要额外做过滤\n>           return self.get_elements_by_xpath(\n                xpath,\n                max_timeout=max_timeout,\n                inner_text=inner_text,\n                text_contains=text_contains,\n                value=value,\n            )\n\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\miniprogram\\base_driver\\page.py:373: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nargs = (Page(id=86, path=/pages/trip/spot-detail, query={'spotId': 'a705468ad4674dea805f051c5e27c9e6', 'activityId': '6d4c3aed7bc9402d871788bb4d0adda6', 'appointId': '9273321a2703426dbab0c04e4ca0ca64'}), '/page/view/biz-index-head/view/view')\nkwargs = {'inner_text': None, 'max_timeout': 0, 'text_contains': None, 'value': None}\nstart = datetime.datetime(2023, 8, 23, 15, 52, 15, 432193)\nself = Page(id=86, path=/pages/trip/spot-detail, query={'spotId': 'a705468ad4674dea805f051c5e27c9e6', 'activityId': '6d4c3aed7bc9402d871788bb4d0adda6', 'appointId': '9273321a2703426dbab0c04e4ca0ca64'})\nfunc_name = 'Page.get_elements_by_xpath'\n\n    @wraps(func)\n    def wrapper(*args, **kwargs):\n        global usage, app_id\n    \n        start = datetime.datetime.now()\n        self = args[0]\n        func_name = f\"{self.__class__.__name__}.{func.__name__}\"\n        try:\n>           result = func(*args, **kwargs)\n\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\miniprogram\\base_driver\\minium_log.py:172: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = Page(id=86, path=/pages/trip/spot-detail, query={'spotId': 'a705468ad4674dea805f051c5e27c9e6', 'activityId': '6d4c3aed7bc9402d871788bb4d0adda6', 'appointId': '9273321a2703426dbab0c04e4ca0ca64'})\nxpath = '/page/view/biz-index-head/view/view', max_timeout = 0\ninner_text = None, value = None, text_contains = None, index = -1\n\n    def get_elements_by_xpath(\n        self,\n        xpath,\n        max_timeout=10,\n        inner_text=None,\n        value=None,\n        text_contains=None,\n        index=-1,\n    ) -> ElementType:\n        \"\"\"\n        根据xpath查找元素\n        :param xpath: xpath\n        :param max_timeout: 超时时间\n        :param inner_text: inner_text\n        :param value: value\n        :param text_contains: 包含的文字\n        \"\"\"\n        if inner_text is not None:\n            xpath += '[text()=\"%s\"]' % inner_text\n        elif text_contains is not None:\n            xpath += '[contains(text(), \"%s\")]' % text_contains\n        elif value is not None:\n            xpath += '[@value=\"%s\"]' % value\n    \n        @timeout(max_timeout)\n        def search_elements():\n            return self._get_elements_by_xpath(xpath, index=index)\n    \n>       return search_elements()\n\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\miniprogram\\base_driver\\page.py:441: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nargs = (), kwargs = {}, timeout = 1692777135.432193, execed = False, r = None\n\n    @functools.wraps(func)\n    def wrapper(*args, **kwargs):\n        timeout = time.time() + duration\n        execed = False\n        r = None\n        while not (r or timeout < time.time() and execed):\n>           r = func(*args, **kwargs)\n\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\utils\\utils.py:56: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\n    @timeout(max_timeout)\n    def search_elements():\n>       return self._get_elements_by_xpath(xpath, index=index)\n\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\miniprogram\\base_driver\\page.py:439: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nargs = (Page(id=86, path=/pages/trip/spot-detail, query={'spotId': 'a705468ad4674dea805f051c5e27c9e6', 'activityId': '6d4c3aed7bc9402d871788bb4d0adda6', 'appointId': '9273321a2703426dbab0c04e4ca0ca64'}), '/page/view/biz-index-head/view/view')\nkwargs = {'index': -1}, _cnt = 1, e = PageDestroyed('page destroyed')\n\n    @functools.wraps(func)\n    def wrapper(*args, **kwargs):\n        _cnt = 0\n        while _cnt < cnt:\n            try:\n                _cnt += 1\n>               ret = func(*args, **kwargs)\n\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\utils\\utils.py:82: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = Page(id=86, path=/pages/trip/spot-detail, query={'spotId': 'a705468ad4674dea805f051c5e27c9e6', 'activityId': '6d4c3aed7bc9402d871788bb4d0adda6', 'appointId': '9273321a2703426dbab0c04e4ca0ca64'})\nxpath = '/view/biz-index-head/view/view', index = -1\n\n    def _get_elements_by_xpath(self, xpath: str, index=-1) -> typing.List[ElementType]:\n        \"\"\"\n        description: 通过xpath获取元素\n        param {*} self\n        param {str} xpath\n        return {*} List[ElementType]\n        \"\"\"\n        xpath = (\n            xpath[5:] if xpath.find(\"/page/\") == 0 else xpath\n        )  # xpath不能以/page/开头（不存在的根节点）\n        if not self._can_i_use(\"Page.getElementsByXpath\"):\n            el = self._get_element_by_xpath(xpath)  # 降级使用Page.getElementByXpath\n            return [el] if el else []\n        try:\n>           ret = self._send(\"Page.getElementsByXpath\", {\"selector\": xpath})\n\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\miniprogram\\base_driver\\page.py:658: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = Page(id=86, path=/pages/trip/spot-detail, query={'spotId': 'a705468ad4674dea805f051c5e27c9e6', 'activityId': '6d4c3aed7bc9402d871788bb4d0adda6', 'appointId': '9273321a2703426dbab0c04e4ca0ca64'})\nmethod = 'Page.getElementsByXpath'\nparams = {'pageId': 86, 'selector': '/view/biz-index-head/view/view'}\nsync = True\n\n    def _send(self, method, params=None, sync=True):\n        if params is None:\n            params = {}\n        params[\"pageId\"] = self.page_id\n        # self.logger.debug(f\"method {method}, params: {params}\")\n        return (\n>           self.connection.send(method, params)\n            if sync\n            else self.connection.send_async(method, params)\n        )\n\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\miniprogram\\base_driver\\page.py:488: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <minium.miniprogram.base_driver.connection.Connection object at 0x0000014D5FCB0DC0>\nmethod = 'Page.getElementsByXpath'\nparams = {'pageId': 86, 'selector': '/view/biz-index-head/view/view'}\nmax_timeout = None\n\n    def send(self, method: str or Command, params=None, max_timeout=None):\n        # 同步发送消息，函数会阻塞\n        cmd: Command = self._gen_command(method, params, max_timeout)\n        with cmd:\n            self._sync_wait_map[cmd.id] = None  # 该ID未有返回message\n            self._safely_send(cmd)\n>           return self._receive_response(cmd)\n\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\miniprogram\\base_driver\\connection.py:447: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <minium.miniprogram.base_driver.connection.Connection object at 0x0000014D5FCB0DC0>\ncmd = <minium.miniprogram.base_driver.connection.Command object at 0x0000014D5FD66AD0>\n\n    def _receive_response(self, cmd: Command):\n        # 等待接收到message的通知\n        while cmd.max_timeout > 0:\n            self._wait(cmd)\n    \n            if (\n                cmd.id in self._sync_wait_map\n                and self._sync_wait_map[cmd.id] is not None\n            ):  # 获取到了数据\n                response = self._sync_wait_map.pop(cmd.id)\n                if isinstance(response, MiniAppError):\n>                   raise response\nE                   minium.framework.exception.PageDestroyed: page destroyed\n\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\miniprogram\\base_driver\\connection.py:473: PageDestroyed\n\nDuring handling of the above exception, another exception occurred:\n\nself = <tests.test_login.TestShouYe_1 testMethod=test_handle_modal_01>\n\n    def test_handle_modal_01(self):\n        callback = Callback()  # 监听回调, 阻塞当前主线程\n    \n        # 监听showModal回调, 确认由弹窗弹出\n        self.app.hook_wx_method(\"showModal\", callback=callback.callback)\n        self.page.get_element('text=\"当前为测试模拟环境，请勿进行真实业务行为!\"').tap()  # 触发弹窗\n        time.sleep(2)\n        self.native.handle_modal(\"知道了\")  # 点击弹窗的\"确定\"按钮\n        # 定位\n>       elements = self.page.get_elements('/page/view/biz-index-head/view/view')\n\ntests\\test_login.py:34: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\miniprogram\\base_driver\\app.py:217: in wrapper\n    return attr(*args, **kwargs)\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\miniprogram\\base_driver\\minium_log.py:172: in wrapper\n    result = func(*args, **kwargs)\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\miniprogram\\base_driver\\page.py:373: in get_elements\n    return self.get_elements_by_xpath(\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\miniprogram\\base_driver\\minium_log.py:172: in wrapper\n    result = func(*args, **kwargs)\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\miniprogram\\base_driver\\page.py:441: in get_elements_by_xpath\n    return search_elements()\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\utils\\utils.py:56: in wrapper\n    r = func(*args, **kwargs)\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\miniprogram\\base_driver\\page.py:439: in search_elements\n    return self._get_elements_by_xpath(xpath, index=index)\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\utils\\utils.py:82: in wrapper\n    ret = func(*args, **kwargs)\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\miniprogram\\base_driver\\page.py:658: in _get_elements_by_xpath\n    ret = self._send(\"Page.getElementsByXpath\", {\"selector\": xpath})\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\miniprogram\\base_driver\\page.py:488: in _send\n    self.connection.send(method, params)\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\miniprogram\\base_driver\\connection.py:447: in send\n    return self._receive_response(cmd)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <minium.miniprogram.base_driver.connection.Connection object at 0x0000014D5FCB0DC0>\ncmd = <minium.miniprogram.base_driver.connection.Command object at 0x0000014D5FD66410>\n\n    def _receive_response(self, cmd: Command):\n        # 等待接收到message的通知\n        while cmd.max_timeout > 0:\n            self._wait(cmd)\n    \n            if (\n                cmd.id in self._sync_wait_map\n                and self._sync_wait_map[cmd.id] is not None\n            ):  # 获取到了数据\n                response = self._sync_wait_map.pop(cmd.id)\n                if isinstance(response, MiniAppError):\n>                   raise response\nE                   minium.framework.exception.PageDestroyed: page destroyed\n\nD:\\software\\python-3.10.10\\lib\\site-packages\\minium\\miniprogram\\base_driver\\connection.py:473: PageDestroyed","flaky":false,"newFailed":false,"newBroken":false,"newPassed":false,"retriesCount":0,"retriesStatusChange":false,"beforeStages":[],"afterStages":[],"labels":[{"name":"feature","value":"粮油副食"},{"name":"suite","value":"首页"},{"name":"parentSuite","value":"tests"},{"name":"subSuite","value":"TestShouYe_1"},{"name":"host","value":"LAPTOP-7PGH1LS0"},{"name":"thread","value":"13096-MainThread"},{"name":"framework","value":"pytest"},{"name":"language","value":"cpython3"},{"name":"package","value":"tests.test_login"},{"name":"resultFormat","value":"allure2"}],"parameters":[],"links":[],"hidden":true,"retry":true,"extra":{"categories":[],"tags":[]},"source":"69a051a6932ed072.json","parameterValues":[]}